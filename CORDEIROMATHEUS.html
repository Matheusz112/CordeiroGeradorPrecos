<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Dinâmico - Supermercado</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --menu-bg: #FFFFFF;
            --input-bg: #D6EAF8;
            --text-color: #000000;
            --highlight: #2980B9;
            --hover-highlight: #1F618D;
            --icon-color: #FFFFFF;
            --border-color: #2980B9;
            --layout1-bg: #3498DB;
            --layout2-bg: #1F618D;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #E3F2FD, #AED6F1);
            margin: 10px;
            font-family: Arial, sans-serif;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .menu {
            width: 280px;
            background-color: var(--menu-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            color: var(--text-color);
            position: fixed;
            top: 0;
            left: 0;
        }

            .menu img {
                display: block;
                margin: 0 auto;
                width: 110px;
                border-radius: 10%;
            }

        .form-group {
            margin-bottom: 10px;
        }

        .input-container {
            position: relative;
            width: 100%;
        }

            .input-container i {
                position: absolute;
                left: 6px;
                top: 50%;
                transform: translateY(-50%);
                font-size: 13px;
                color: var(--border-color);
            }

            .input-container input {
                width: 100%;
                height: 30px;
                padding: 0 6px 0 24px;
                border: 1px solid var(--border-color);
                border-radius: 12px;
                background-color: var(--input-bg);
                color: var(--text-color);
                font-size: 17px;
            }

        .radio-group p, .checkbox-group p {
            margin-bottom: 6px;
            font-size: 14px;
        }

        .radio-label, .checkbox-label {
            display: flex;
            align-items: center;
            font-size: 14px;
            margin-bottom: 6px;
        }

            .radio-label input, .checkbox-label input {
                margin-right: 6px;
            }

        .menu button {
            width: 100%;
            height: 34px;
            border: none;
            border-radius: 12px;
            background-color: var(--highlight);
            color: var(--icon-color);
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

            .menu button:hover {
                background-color: var(--hover-highlight);
            }

        #btnToggleLayout.layout1 {
            background-color: var(--layout1-bg);
        }

        #btnToggleLayout.layout2 {
            background-color: var(--layout2-bg);
        }

        #tamanho-slider {
            width: 100%;
        }

        #slider-value {
            text-align: center;
            font-size: 14px;
            margin-top: 5px;
        }

        .planilha {
            position: relative;
            background-color: #f9f9f9;
            border: 3px solid #000;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            margin-top: 20px;
            justify-content: space-between;
            width: 100%;
        }

            .planilha img.logo {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 190px;
                height: fit-content;
                display: none;
                margin-left: 50px;
            }

        .produto {
            font-weight: bold;
            font-size: 30px;
            margin-bottom: 10px;
        }

        .info {
            font-size: 12px;
            margin-bottom: 3px;
        }

            .info i {
                margin-right: 20px;
            }

        .adicional {
            font-size: 27px;
            margin-top: 3px;
            font-weight: bold;
        }

        .preco {
            font-size: 60px;
            font-weight: bold;
            color: #000000;
            margin: 10px 0;
        }

        .content {
            margin-left: 270px;
            padding: 20px;
            flex: 1;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            margin-top: 20px;
            color: white;
        }

            .checkbox-container input[type="checkbox"] {
                display: none;
            }

        .checkbox-custom {
            width: 20px;
            height: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease;
            flex-shrink: 0;
        }

            .checkbox-custom i {
                display: none;
            }

        .checkbox-container input[type="checkbox"]:checked + .checkbox-custom {
            background-color: #007bff;
            border-color: #007bff;
        }

            .checkbox-container input[type="checkbox"]:checked + .checkbox-custom i {
                display: block;
                color: white;
            }

        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #1c1c1c;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 1000;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

            .popup .checkmark {
                display: inline-block;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                background-color: #4caf50;
                position: relative;
                animation: pop-up 0.5s ease forwards;
            }

                .popup .checkmark::before {
                    content: '';
                    position: absolute;
                    width: 15px;
                    height: 30px;
                    border-right: 5px solid white;
                    border-bottom: 5px solid white;
                    top: 10px;
                    left: 18px;
                    transform: rotate(45deg);
                }

            .popup .message {
                margin-top: 10px;
                font-size: 18px;
                color: antiquewhite;
            }

        @keyframes pop-up {
            0% {
                transform: scale(0);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        .menuProdutos {
            position: absolute;
            top: 10px;
            right: 0;
            max-width: 300px;
            background-color: #007bff;
            border: 1px solid #0056b3;
            border-radius: 5px;
            padding: 5px;
            box-sizing: border-box;
            display: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease-out;
        }

            .menuProdutos h3 {
                margin: 0;
                padding: 10px;
                background-color: #0056b3;
                color: white;
                border-radius: 5px 5px 0 0;
                text-align: center;
                font-size: 18px;
                animation: slideDown 0.3s ease-out;
            }

            .menuProdutos ul {
                list-style-type: none;
                padding: 0;
                margin: 0;
            }

            .menuProdutos li {
                cursor: pointer;
                padding: 10px;
                font-weight: bold;
                color: #fff;
                transition: background-color 0.2s ease-in-out;
            }

                .menuProdutos li:nth-child(even) {
                    background-color: #0069d9;
                }

                .menuProdutos li:hover {
                    background-color: #0056b3;
                }

        @keyframes slideDown {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .popupcordeiro {
            display: none;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
        }

        .popupcordeiro-content {
            width: 400px;
            height: 500px;
            background-color: #fff;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .popupcordeiro h2 {
            font-weight: bold;
            color: #333;
            margin-top: 0;
        }

        .logocordeiro {
            max-width: 200px;
            margin-bottom: 10px;
            pointer-events: none;
        }

        .loader {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-block;
            border-top: 4px solid #2196F3;
            border-right: 4px solid transparent;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
            margin-bottom: 10px;
        }

            .loader::after {
                content: '';
                box-sizing: border-box;
                position: absolute;
                left: 0;
                top: 0;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                border-left: 4px solid #000;
                border-bottom: 4px solid transparent;
                animation: rotation 0.5s linear infinite reverse;
            }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .delete-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 20px;
            color: red;
            cursor: pointer;
        }

        .edit-icon {
            position: absolute;
            top: 50px;
            left: 10px;
            font-size: 20px;
            color: darkseagreen;
            cursor: pointer;
        }

        .resize-handle {
            width: 10px;
            height: 100%;
            background: linear-gradient(to right, #555, #222);
            position: absolute;
            top: 0;
            right: 0;
            cursor: ew-resize;
            transition: background 0.3s ease, box-shadow 0.3s ease;
            border-radius: 5px;
        }

            .resize-handle:hover {
                background: linear-gradient(to right, #777, #444);
                box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            }

        .containerDeletados {
            position: relative;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 400px;
            text-align: center;
            overflow: hidden;
            max-height: 80vh;
            border: 2px solid #ddd;
            margin-top: 20px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .containerDeletados h4 {
            font-size: 22px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .containerDeletados ul {
            list-style-type: none;
            padding-left: 0;
            font-size: 16px;
            color: #555;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }

        .containerDeletados li {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 16px;
            color: #444;
        }

            .containerDeletados li i {
                margin-right: 10px;
                color: #ff6347;
            }

        .containerDeletados button {
            background-color: #4CAF50;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
            width: 100%;
            transition: background-color 0.3s;
        }

            .containerDeletados button:hover {
                background-color: #45a049;
            }

        #mensagemSucesso {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.6);
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .fa-trash {
            color: red;
        }

        #popupDeletaPrecos {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2980b9;
            color: #fff;
            padding: 30px;
            border-radius: 12px;
            width: 400px;
            text-align: center;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.3s ease-in-out;
        }

            #popupDeletaPrecos.show {
                display: block;
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            #popupDeletaPrecos h3 {
                font-size: 22px;
                margin-bottom: 20px;
                font-weight: 600;
                color: #ecf0f1;
            }

            #popupDeletaPrecos ul {
                list-style-type: none;
                padding: 0;
                margin: 0;
                font-size: 18px;
                color: #ecf0f1;
                text-align: left;
                position: relative;
            }

                #popupDeletaPrecos ul li {
                    background-color: #3498db;
                    margin: 10px 0;
                    padding: 10px;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                    opacity: 0;
                    transform: translateY(20px);
                    animation: slideUp 0.5s ease-out forwards;
                    transition: opacity 1s ease-out, transform 1s ease-out;
                }

                    #popupDeletaPrecos ul li:nth-child(1) {
                        animation-delay: 0s;
                    }

                    #popupDeletaPrecos ul li:nth-child(2) {
                        animation-delay: 0.2s;
                    }

                    #popupDeletaPrecos ul li:nth-child(3) {
                        animation-delay: 0.4s;
                    }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #popupDeletaPrecos ul li.deleting {
            opacity: 0;
            transform: translateX(100%) rotate(30deg);
            transition: all 1s ease-out;
        }

        #popupDeletaPrecos ul li i {
            margin-right: 12px;
            color: #e74c3c;
            transition: all 1s ease-out;
        }

        .fa-trash {
            font-size: 20px;
            transition: transform 0.5s ease-in-out;
        }

        .deleting i.fa-trash {
            transform: scale(1.2) rotate(100deg);
        }

        .tag {
            border: 4px solid #000 !important;
            background: #fff !important;
            position: relative;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: fit-content;
            min-width: 340px;
            padding: 0;
        }

        .topo {
            background: linear-gradient(135deg, #1c2526, #2f3e46) !important;
            color: #fff !important;
            text-align: center;
            padding: 12px 16px;
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

            .topo i {
                font-size: 24px;
            }

        .valor {
            font-size: 60px;
            text-align: center;
            font-weight: bold;
            margin: 10px 0;
            color: #000 !important;
            background: #fff !important;
        }

        .unitario {
            font-size: 23px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            color: #000 !important;
            background: #fff !important;
        }

            .unitario i {
                margin-right: 5px;
            }

        .rodape {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            border-top: 5px solid #000 !important;
            background: #fff !important;
        }

        .codigo {
            background: #000 !important;
            color: #fff !important;
            padding: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: bold;
            font-size: 18px;
            width: auto;
        }

        .app-text {
            font-size: 12px;
            color: #000;
            padding: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
            background: #fff !important;
            white-space: nowrap;
        }

            .app-text i {
                color: #2980B9;
            }

        .qr-code-container {
            padding: 6px;
            background: #fff !important;
            display: flex;
            align-items: center;
        }

        .data {
            padding: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            width: 50%;
            justify-content: flex-end;
            font-weight: bold;
            color: #000 !important;
            background: #fff !important;
        }

        @media print {
            .pagina-impressao {
                page-break-inside: avoid;
                break-inside: avoid;
            }

            .planilha, .tag {
                page-break-inside: avoid;
                break-inside: avoid;
                margin-bottom: 10px;
            }

            .resize-handle, .delete-icon, .edit-icon, .menu, .menu-container, .menus, .input-container, .btn-container, .print-container, .layout-modal, .layout-status {
                display: none !important;
            }

            body {
                margin: 0;
                font-family: Arial, sans-serif;
                display: flex;
                align-items: flex-start;
                justify-content: center;
                height: 100vh;
            }

            @page {
                size: A4;
                margin: 0;
            }
        }

        .wrapper {
            display: flex;
            width: 120%;
            margin-bottom: 20px;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            font-size: 12px;
            border: 2px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s, border 0.3s;
        }

            .option i {
                margin-left: 5px;
                font-size: 14px;
            }

        .dot {
            width: 12px;
            height: 12px;
            background: #ddd;
            border-radius: 50%;
            margin-right: 8px;
            position: relative;
            transition: background 0;
        }

            .dot::before {
                content: "";
                position: absolute;
                top: 2px;
                left: 2px;
                width: 8px;
                height: 8px;
                background: #0069d9;
                border-radius: 50%;
                opacity: 0;
                transition: opacity 0.3s, transform 0.3s;
            }

        input[type="radio"] {
            display: none;
        }

        input:checked + .option {
            background: #0069d9;
            border-color: #0069d9;
            color: white;
        }

            input:checked + .option .dot {
                background: #fff;
            }

                input:checked + .option .dot::before {
                    opacity: 1;
                    transform: scale(1.2);
                }

        .option:hover {
            background: #f0f0f0;
        }

        .checkbox-group {
            align-items: center;
            cursor: pointer;
            float: left;
        }

            .checkbox-group input {
                position: absolute;
                opacity: 0;
                cursor: pointer;
                height: 0;
                width: 0;
                outline: none;
                -webkit-appearance: none;
            }

        .custom-checkbox {
            width: 18px;
            height: 18px;
            border: 1px solid #ccc;
            border-radius: 3px;
            background: #fff;
            margin-right: 6px;
            position: relative;
        }

            .custom-checkbox svg {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
            }

        .checkbox-group label.checkbox-label {
            font-size: 14px;
            color: #555;
            user-select: none;
            display: inline-flex;
            align-items: center;
            white-space: nowrap;
            cursor: pointer;
        }

        .checkmark {
            fill: none;
            stroke: #3498db;
            stroke-width: 2;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .checkbox-group input:checked ~ label.checkbox-label .custom-checkbox svg path {
            opacity: 1;
            animation: draw 0.5s forwards;
        }

        @keyframes draw {
            from {
                stroke-dashoffset: 48;
            }

            to {
                stroke-dashoffset: 0;
            }
        }

        /* Modal Styles */
        .layout-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .layout-modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            width: 600px;
            max-width: 90%;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }

            .layout-modal-content h2 {
                font-size: 24px;
                margin-bottom: 20px;
                color: #333;
            }

        .layout-options {
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }

        .layout-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            width: 45%;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            position: relative;
            overflow: hidden;
        }

            .layout-card:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
                background-color: #e3f2fd;
            }

            .layout-card.selected {
                border: 2px solid #2980B9;
                background-color: #d6eaf8;
            }

            .layout-card img {
                width: 100%;
                height: auto;
                border-radius: 8px;
                margin-bottom: 10px;
            }

            .layout-card h3 {
                font-size: 18px;
                margin: 10px 0;
                color: #333;
            }

            .layout-card p {
                font-size: 14px;
                color: #555;
            }

        .layout-modal-content button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #2980B9;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

            .layout-modal-content button:hover {
                background-color: #1F618D;
            }

        .layout-status {
            margin-top: 10px;
            font-size: 14px;
            color: #333;
            text-align: center;
        }

        @media (max-width: 600px) {
            .layout-options {
                flex-direction: column;
                align-items: center;
            }

            .layout-card {
                width: 80%;
            }
        }
    </style>
</head>
<body>
    <div class="menu" id="menus">
        <img src="Orbit.gif" alt="Logo">
        <div class="form-group">
            <div class="input-container">
                <i class="fas fa-tag"></i>
                <input type="text" id="produto-input" placeholder="Digite o produto para o formato de tag">
            </div>
        </div>
        <div class="form-group">
            <div class="input-container">
                <i class="fas fa-calendar-alt"></i>
                <input type="text" id="data-input" placeholder="Ex: 01/01/2025">
            </div>
        </div>
        <div class="form-group">
            <div class="input-container">
                <i class="fas fa-dollar-sign"></i>
                <input type="number" id="precos" value="0.0" step="0.01" min="0.01" placeholder="Informe o preço">
            </div>
        </div>
        <div class="form-group">
            <div class="input-container">
                <i class="fas fa-search"></i>
                <input type="text" id="codigo-input" placeholder="Procurar Produto / EAN 13" oninput="preencherProduto()">
            </div>
        </div>
        <div class="form-group">
            <div class="input-container">
                <i class="fas fa-tint"></i>
                <input type="text" id="preco-litro-input" placeholder="Ex: 500 ML ou 1 Litro">
            </div>
        </div>
        <div class="wrapper">
            <input type="radio" name="opcao" value="6" id="op1">
            <label class="option" for="op1"><div class="dot"></div> Fardo 6 uni <i class="fas fa-box"></i></label>
            <input type="radio" name="opcao" value="12" id="op2">
            <label class="option" for="op2"><div class="dot"></div> Fardo 12 uni <i class="fas fa-box"></i></label>
        </div>
        <div class="checkbox-group">
            <input type="checkbox" id="logo-checkbox">
            <label class="checkbox-label" for="logo-checkbox">
                <div class="custom-checkbox">
                    <svg viewBox="0 0 24 24">
                        <path class="checkmark" d="M4 12l5 5L20 7"></path>
                    </svg>
                </div>
                Com Qr code baixar App Cordeiro?
            </label>
        </div>
        <div class="form-group">
            <button type="button" id="btnImprimir"><i class="fas fa-print"></i> Imprimir</button>
        </div>
        <div class="form-group">
            <button type="button" id="btnExcluir" onclick="limparPrecos()"><i class="fas fa-trash-alt"></i> Excluir</button>
        </div>
        <div class="form-group">
            <button type="button" id="btnBuscar" onclick="carregarDados()"><i class="fas fa-database"></i> Buscar</button>
        </div>
        <div class="form-group">
            <button type="button" id="btnAdicionar"><i class="fas fa-plus"></i> Adicionar</button>
        </div>
        <div class="form-group">
            <button type="button" id="btnToggleLayout" class="layout2"><i class="fas fa-exchange-alt"></i> Mudar layout</button>
        </div>
        <div class="layout-status" id="layout-status">Formato atual: Tag</div>
    </div>
    <div id="containerDeletados"></div>
    <div class="content">
        <div id="planilhas">
            <div class="tag" id="planilha">
                <i class="fas fa-times-circle delete-icon" onclick="excluirTabela(this)"></i>
                <i class="fas fa-edit edit-icon" onclick="editarTabela(this)"></i>
                <img src="https://i.imgur.com/tIxuIE3.png" class="logo" alt="Logo" style="display: none; position: absolute; top: 10px; right: 10px; width: 190px; height: fit-content; margin-left: 50px;">
                <div class="topo"><i class="fa-solid fa-box"></i> PRECO DEMONSTRATIVO</div>
                <div class="valor">R$ 19,99</div>
                <div class="unitario"><i class="fa-solid fa-droplet"></i>Preço por litro: R$ 00,99</div>
                <div class="rodape">
                    <div class="codigo"><i class="fa-solid fa-barcode"></i>0000078936683</div>
                    <div class="data"><i class="fa-solid fa-calendar-day"></i>DD/MM/AAAA</div>
                </div>
                <div class="resize-handle"></div>
            </div>
        </div>
    </div>
    <div id="popupcordeiro" class="popupcordeiro">
        <div class="popupcordeiro-content">
            <img src="https://is5-ssl.mzstatic.com/image/thumb/Purple126/v4/66/60/90/666090de-4f6d-35c5-9f83-cbbcdc290738/source/256x256bb.jpg" alt="Logo" class="logocordeiro">
            <h2 id="popup-message">Carregando dados necessários...</h2>
            <span class="loader"></span>
        </div>
    </div>
    <div class="popup" id="popup">
        <div class="checkmark"></div>
        <div class="message">Preços limpos com sucesso</div>
    </div>
    <div class="menuProdutos" id="menuProdutos">
        <h3>PRODUTOS SIMILARES</h3>
        <ul id="sugestoes"></ul>
    </div>
    <div id="popupDeletaPrecos">
        <h3>Alterações Realizadas</h3>
        <ul id="produtosDeletados"></ul>
    </div>
    <!-- Modal for Layout Selection -->
    <div id="layoutModal" class="layout-modal">
        <div class="layout-modal-content">
            <h2>Escolha o Formato de Preço</h2>
            <div class="layout-options">
                <div class="layout-card" data-layout="antigo">
                    <img src="https://i.postimg.cc/YqJ92LCR/produtoantigo.png" alt="Layout Antigo">
                    <h3>Layout Antigo</h3>
                    <p>Formato clássico com design de planilha, ideal para exibição detalhada.  Vantagem gastar menos tinta da impresora</p>
                </div>
                <div class="layout-card" data-layout="novo">
                    <img src="https://i.postimg.cc/HxXG2jgY/produtonovo.png" alt="Layout Novo">
                    <h3>Layout Novo</h3>
                    <p>Formato moderno com design de tag, perfeito para visual compacto. Vantagem - Organizada E mais atraente</p>
                </div>
            </div>
            <button id="confirmLayout">Confirmar Seleção</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const produtos = {
            '0000078936683': 'CERV LAGER HEINEKEN LN 6X330ml',
            '7891991015462': 'CERV STELLA ARTOIS LN 6X330ml',
            '7891149108718': 'CERV LAGER CORONA LN 6X330ml',
            '7891991298421': 'CERV LAGER BUDWEISER LN 6X330ml',
            '7896045506040': 'CERV HEINEKEN ZERO ALC LN 6X330ml',
            '7891991297493': 'CERV P MALTE SPATEM LN 6X355ml',
            '7891149104932': 'CERV BRAHMA ZERO ÁLCOOL 12X350ml',
            '7896045506064': 'CERV HEINEKEN ZERO ÁLCOOL 12X350ml',
            '7898367983356': 'CERV EISENBAHN 12X473ml',
            '7896045505340': 'CERVEJA LAGER AMSTEL 12X473ml',
            '7896045506248': 'CERV HEINEKEN LT 12X473ml',
            '7896045503414': 'CERVEJA KAISER 12X473ml',
            '7891991009164': 'CERV PILSEN ANTARTICA 12X473ml',
            '7891991295017': 'CERV ANTARCTICA ORIGINAL 12X473ml',
            '7891149011001': 'CERVEJA BRAHMA 12X473ml',
            '7891991303309': 'CERVEJA STELLA ARTOIS 12X473ml',
            '7891991014236': 'CERVEJA BOHEMIA 473ml',
            '7891991303200': 'CERVE P MALTE SPATEM LT 12X473ml',
            '07891991010153': 'CERV ANTARTICA SUB ZERO 473ml',
            '7896051111016': 'LEITE ITAMBÊ INTEGRAL 12X1L',
            '7896051111702': 'LEITE ITAMBÊ DESNATADO 12X1L',
            '7896051111528': 'LEITE ITAMBÊ SEMIDESNATADO 12X1L',
            '7896122305207': 'LEITE PORTO ALEGRE INTEGRAL 12X1L',
            '7896183202187': 'LEITE QUATA INTEGRAL 12X1L',
            '7898215151708': 'LEITE PIRACANJUBA INTEGRAL 12X1L',
            '7896447500103': 'ÁGUA IGARAPE SEM GÁS 12X500ml',
            '7896447500363': 'ÁGUA IGARAPÉ COM GÁS 12X500ml',
            '000789338738': 'REFRI COCA COLA MINI PET 12X200ml',
            '7800660636419': 'REFRI SUKITA LARANJA PET 12X200ml',
            '07891991014984': 'REFRI SODA LIMONADA PET 12X200ml',
            '7891991014908': 'REFRI GUARANÁ ANTARTICA PET 12X200ml',
            '7891991016124': 'REFRI GUARANÁ ZERO PET 12X200ml',
            '7892840800567': 'REFRI PEPSI PET 12X200ml',
            '7896036090855': 'ÓLEO DE SOJA VELEIRO 6X900ml',
            '7896036090244': 'ÓLEO DE SOJA LIZA 6X900ml',
            '7891149040308': 'CERV MALZBIER BRAHMA 6X355ml',
            '7898915949193': 'CERV PILSEN IMPERIO 12X473ml',
            '7891991012454': 'CERV PILSEN BUDWEISER 12X473ml',
            '7896427701391': 'LEITE INT ITA 12X1L',
            '7898080640017': 'LEITE INT ITALAC 12X1L',
            '7898926669042': 'AGUA MIN GRAO MOGOL 12X500ml',
            '7891991297479': 'CERV P MALTE SPATEM LN 6X355ml',
            '7896045505371': 'CERV LAGER HEINEKEN LN 6X355ml',
            '7898969406963': 'CERV PILSEN BRUDER BX GASTRO 12X473ml',
            '789862528372': 'CERV PILSEN LAUT 12X473ml',
            '7897395099695': 'CERV P MALTE PETRA 12X473ml',
            '7897395020217': 'CERV PILSEN ITAIPAVA LT 12X473ml',
            '7891149201006': 'CERV PILSEN SKOL LT 12X473ml'
        };

        const produtoInput = document.getElementById('produto-input');
        const dataInput = document.getElementById('data-input');
        const precoInput = document.getElementById('precos');
        const codigoInput = document.getElementById('codigo-input');
        const logoCheckbox = document.getElementById('logo-checkbox');
        const btnToggleLayout = document.getElementById('btnToggleLayout');
        const layoutModal = document.getElementById('layoutModal');
        const confirmLayoutBtn = document.getElementById('confirmLayout');
        const layoutStatus = document.getElementById('layout-status');

        let isTagLayout = true; // Layout inicial é tag
        let selectedLayout = 'novo'; // Layout tag pré-selecionado
        let deletedProducts = []; // Lista para armazenar produtos deletados

        // Dados do primeiro produto
        const firstProduct = {
            codigo: '0000078936683',
            nome: 'PRODUTO DEMOSTRATIVO',
            preco: '19.99',
            precoPorLitro: '0.99'
        };

        document.getElementById('btnImprimir').addEventListener('click', imprimirTabelas);
        document.getElementById('btnAdicionar').addEventListener('click', adicionarTabela);
        btnToggleLayout.addEventListener('click', showLayoutModal);

        // Exibir o modal ao carregar a página com tag pré-selecionado
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('popupcordeiro').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('popupcordeiro').style.display = 'none';
            }, 2000);
            showLayoutModal();
        });

        async function preencherProduto() {
            const mlInput = document.getElementById('preco-litro-input');
            const termo = (codigoInput.value || produtoInput.value).trim().toLowerCase();
            const sugestoes = document.getElementById('sugestoes');
            const menuProdutos = document.getElementById('menuProdutos');
            sugestoes.innerHTML = '';

            if (termo === '') {
                menuProdutos.style.display = 'none';
                return;
            }

            try {
                let allProducts = [];
                let nextUrl = 'https://api.baserow.io/api/database/rows/table/322640/?user_field_names=true';

                while (nextUrl) {
                    const response = await axios({
                        method: 'GET',
                        url: nextUrl,
                        headers: {
                            Authorization: 'Token UkqZsuMMnwE59fMqs8OwXX60SASP7FOd'
                        }
                    });

                    allProducts = allProducts.concat(response.data.results);
                    nextUrl = response.data.next;
                }

                const produtosSugeridos = allProducts.filter(item => {
                    const codigo = item.CODIGO ? item.CODIGO.toLowerCase() : '';
                    const nomeProduto = item.PRODUTO ? item.PRODUTO.toLowerCase() : '';
                    return codigo.includes(termo) || nomeProduto.includes(termo);
                });

                if (produtosSugeridos.length === 0) {
                    menuProdutos.style.display = 'none';
                    return;
                }

                menuProdutos.style.display = 'block';
                produtosSugeridos.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item.PRODUTO;
                    li.dataset.codigo = item.CODIGO;
                    li.onclick = () => {
                        codigoInput.value = item.CODIGO;
                        produtoInput.value = item.PRODUTO;
                        precoInput.value = item.PREÇO || '0.0';
                        mlInput.value = item.ML || '';
                        const quantidade = parseInt(item.QUANTIDADE, 10);
                        if (quantidade === 6) {
                            document.querySelector('input[name="opcao"][value="6"]').checked = true;
                        } else if (quantidade === 12) {
                            document.querySelector('input[name="opcao"][value="12"]').checked = true;
                        }
                        menuProdutos.style.display = 'none';
                    };
                    sugestoes.appendChild(li);
                });
            } catch (error) {
                console.error('Erro ao buscar produtos da API:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erro',
                    text: 'Não foi possível carregar os produtos similares.'
                });
                menuProdutos.style.display = 'none';
            }
        }

        function showLayoutModal() {
            layoutModal.style.display = 'flex';
            const cards = document.querySelectorAll('.layout-card');
            cards.forEach(card => {
                card.classList.remove('selected');
                if (card.dataset.layout === 'novo') {
                    card.classList.add('selected');
                    selectedLayout = 'novo';
                }
                card.addEventListener('click', () => {
                    cards.forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    selectedLayout = card.dataset.layout;
                }, { once: true });
            });
        }

        confirmLayoutBtn.addEventListener('click', () => {
            if (selectedLayout) {
                isTagLayout = selectedLayout === 'novo';
                toggleLayout();

                // Atualizar o campo de produto e preço com base no primeiro produto
                produtoInput.value = firstProduct.nome;
                produtoInput.placeholder = isTagLayout ? 'Digite o produto para o formato de tag' : 'Digite o produto para o formato de planilha';
                layoutStatus.textContent = isTagLayout ? 'Formato atual: Tag' : 'Formato atual: Planilha';
                precoInput.value = firstProduct.preco;
                document.getElementById('preco-litro-input').value = firstProduct.precoPorLitro;
                codigoInput.value = firstProduct.codigo;

                // Atualizar o preço no topo da tag ou planilha
                const planilhaContainer = document.getElementById('planilhas');
                const currentPlanilha = planilhaContainer.querySelector('.planilha, .tag');
                if (currentPlanilha) {
                    const precoElement = currentPlanilha.querySelector(isTagLayout ? '.valor' : '.preco');
                    if (precoElement) {
                        precoElement.textContent = `R$ ${firstProduct.preco.replace('.', ',')}`;
                    }
                    const produtoElement = currentPlanilha.querySelector(isTagLayout ? '.topo' : '#produto-nome');
                    if (produtoElement) {
                        if (isTagLayout) {
                            produtoElement.innerHTML = `<i class="fa-solid fa-box"></i> ${firstProduct.nome}`;
                        } else {
                            produtoElement.textContent = firstProduct.nome;
                        }
                    }
                    const precoPorLitroElement = currentPlanilha.querySelector(isTagLayout ? '.unitario' : '#preco-por-litro');
                    if (precoPorLitroElement) {
                        precoPorLitroElement.innerHTML = isTagLayout
                            ? `<i class="fa-solid fa-droplet"></i>Preço por litro: R$ ${firstProduct.precoPorLitro.replace('.', ',')}`
                            : `1 LITRO SAI POR R$ ${firstProduct.precoPorLitro.replace('.', ',')}`;
                    }
                    const codigoElement = currentPlanilha.querySelector(isTagLayout ? '.codigo' : null);
                    if (codigoElement) {
                        codigoElement.innerHTML = `<i class="fa-solid fa-barcode"></i>${firstProduct.codigo}`;
                    }
                    currentPlanilha.dataset.codigo = firstProduct.codigo;
                }

                layoutModal.style.display = 'none';

                Swal.fire({
                    icon: 'success',
                    title: 'Layout Alterado',
                    text: `O formato de preço foi alterado para ${isTagLayout ? 'Layout Novo' : 'Layout planilha'} e o preço foi atualizado para o primeiro produto! para visualizar melhor`
                });
            } else {
                Swal.fire({
                    icon: 'warning',
                    title: 'Selecione um layout',
                    text: 'Por favor, escolha um formato de preço antes de confirmar.'
                });
            }
        });

        function adicionarItemAPagina(planilhaContainer, novaPlanilha) {
            let grupos = planilhaContainer.querySelectorAll('.grupo-impressao');
            let grupoAtual;

            if (grupos.length === 0 || grupos[grupos.length - 1].querySelectorAll('.planilha, .tag').length >= 6) {
                grupoAtual = document.createElement('div');
                grupoAtual.classList.add('grupo-impressao');
                planilhaContainer.appendChild(grupoAtual);
            } else {
                grupoAtual = grupos[grupos.length - 1];
            }

            grupoAtual.appendChild(novaPlanilha);
        }

        function adicionarTabela() {
            const radios = document.querySelectorAll('input[name="opcao"]');
            let valorSelecionado = 0;

            for (const radio of radios) {
                if (radio.checked) {
                    valorSelecionado = parseFloat(radio.value);
                    break;
                }
            }

            const today = new Date();
            const formattedDateTime = today.toLocaleString('pt-BR');
            dataInput.value = formattedDateTime;

            const produto = produtoInput.value || firstProduct.nome;
            const data = dataInput.value || "DD/MM/AAAA";
            const preco = parseFloat(precoInput.value.replace(',', '.')) || parseFloat(firstProduct.preco);
            const codigo = codigoInput.value || firstProduct.codigo;
            const precoLitroInput = document.getElementById('preco-litro-input').value.replace(/[^0-9.]/g, '');
            const precoLitro = parseFloat(precoLitroInput) || parseFloat(firstProduct.precoPorLitro);
            const comLogo = logoCheckbox.checked;

            let soma = (preco / precoLitro) * 1000;
            if (produto.toLowerCase().includes('leite')) {
                soma /= 1000;
            }

            const total = preco * valorSelecionado;

            const planilhaContainer = document.getElementById('planilhas');
            if (!planilhaContainer) {
                alert("O contêiner de planilhas não foi encontrado.");
                return;
            }

            const novaPlanilha = document.createElement('div');
            novaPlanilha.classList.add(isTagLayout ? 'tag' : 'planilha');
            novaPlanilha.style.breakInside = 'avoid';
            novaPlanilha.dataset.codigo = codigo;

            if (isTagLayout) {
                novaPlanilha.innerHTML = `
                        <i class="fas fa-times-circle delete-icon" onclick="excluirTabela(this)"></i>
                        <i class="fas fa-edit edit-icon" onclick="editarTabela(this)"></i>
                        <img src="https://i.imgur.com/tIxuIE3.png" class="logo" alt="Logo" style="display: ${comLogo ? 'block' : 'none'}; position: absolute; top: 10px; right: 10px; width: 190px; height: fit-content; margin-left: 50px;">
                        <div class="topo"><i class="fa-solid fa-box"></i> ${produto}</div>
                        <div class="valor">R$ ${total.toFixed(2).replace('.', ',')}</div>
                        <div class="unitario"><i class="fa-solid fa-droplet"></i>Preço por litro: R$ ${soma.toFixed(2).replace('.', ',')}</div>
                        <div class="rodape">
                            <div class="codigo"><i class="fa-solid fa-barcode"></i>${codigo}</div>
                            <div class="data"><i class="fa-solid fa-calendar-day"></i>${data}</div>
                        </div>
                        <div class="resize-handle"></div>
                    `;
            } else {
                novaPlanilha.innerHTML = `
                        <i class="fas fa-times-circle delete-icon" onclick="excluirTabela(this)"></i>
                        <i class="fas fa-edit edit-icon" onclick="editarTabela(this)"></i>
                        <img src="https://i.imgur.com/tIxuIE3.png" class="logo" alt="Logo" style="display: ${comLogo ? 'block' : 'none'}; width: 190px; height: fit-content; margin-left: 10px;">
                        <div class="content-container">
                            <div class="produto" id="produto-nome">${produto}</div>
                            <div class="info">
                                <span class="preco">R$ ${total.toFixed(2).replace('.', ',')}</span>
                            </div>
                            <div class="adicional">
                                <span id="preco-por-litro">1 LITRO SAI POR R$ ${soma.toFixed(2).replace('.', ',')}</span>
                                <div class="info">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span id="data-emitida">Data emitida: ${data}</span>
                                </div>
                            </div>
                        </div>
                        <div class="resize-handle"></div>
                    `;
            }

            adicionarItemAPagina(planilhaContainer, novaPlanilha);
            ativarRedimensionamento(novaPlanilha);
            atualizarVisibilidadeLogo();
        }

        function toggleLayout() {
            const planilhaContainer = document.getElementById('planilhas');
            const existingPlanilhas = planilhaContainer.querySelectorAll('.planilha, .tag');

            if (existingPlanilhas.length === 0) {
                console.warn('No planilhas found to toggle layout.');
                return;
            }

            existingPlanilhas.forEach(planilha => {
                // Extrair dados da tag ou planilha
                let produto = firstProduct.nome;
                let preco = firstProduct.preco;
                let precoPorLitro = firstProduct.precoPorLitro;
                let data = 'DD/MM/AAAA';
                let codigo = firstProduct.codigo;
                let comLogo = false;

                // Tentar extrair dados do elemento atual
                const produtoElement = planilha.querySelector(isTagLayout ? '.topo' : '#produto-nome');
                if (produtoElement) {
                    produto = produtoElement.textContent.replace(/^\s*[\w\s]+\s*/, '').trim() || firstProduct.nome;
                }

                const precoElement = planilha.querySelector(isTagLayout ? '.valor' : '.preco');
                if (precoElement) {
                    preco = precoElement.textContent.replace('R$ ', '').replace(',', '.') || firstProduct.preco;
                }

                const precoPorLitroElement = planilha.querySelector(isTagLayout ? '.unitario' : '#preco-por-litro');
                if (precoPorLitroElement) {
                    const match = precoPorLitroElement.textContent.match(/R\$ \d+,\d{2}/);
                    precoPorLitro = match ? match[0].replace('R$ ', '').replace(',', '.') : firstProduct.precoPorLitro;
                }

                const dataElement = planilha.querySelector(isTagLayout ? '.data' : '#data-emitida');
                if (dataElement) {
                    data = dataElement.textContent.replace('Data emitida: ', '').trim() || 'DD/MM/AAAA';
                }

                const codigoElement = isTagLayout ? planilha.querySelector('.codigo') : null;
                if (codigoElement) {
                    codigo = codigoElement.textContent.replace(/^\s*[\w\s]+\s*/, '').trim() || firstProduct.codigo;
                } else {
                    codigo = planilha.dataset.codigo || firstProduct.codigo;
                }

                const logoElement = planilha.querySelector('.logo');
                if (logoElement) {
                    comLogo = logoElement.style.display === 'block';
                }

                // Criar novo elemento no layout oposto
                const novaPlanilha = document.createElement('div');
                novaPlanilha.classList.add(isTagLayout ? 'tag' : 'planilha');
                novaPlanilha.style.breakInside = 'avoid';
                novaPlanilha.dataset.codigo = codigo;

                if (isTagLayout) {
                    novaPlanilha.innerHTML = `
                            <i class="fas fa-times-circle delete-icon" onclick="excluirTabela(this)"></i>
                            <i class="fas fa-edit edit-icon" onclick="editarTabela(this)"></i>
                            <img src="https://i.imgur.com/tIxuIE3.png" class="logo" alt="Logo" style="display: ${comLogo ? 'block' : 'none'}; position: absolute; top: 10px; right: 10px; width: 190px; height: fit-content; margin-left: 50px;">
                            <div class="topo"><i class="fa-solid fa-box"></i> ${produto}</div>
                            <div class="valor">R$ ${parseFloat(preco).toFixed(2).replace('.', ',')}</div>
                            <div class="unitario"><i class="fa-solid fa-droplet"></i>Preço por litro: R$ ${parseFloat(precoPorLitro).toFixed(2).replace('.', ',')}</div>
                            <div class="rodape">
                                <div class="codigo"><i class="fa-solid fa-barcode"></i>${codigo}</div>
                                <div class="data"><i class="fa-solid fa-calendar-day"></i>${data}</div>
                            </div>
                            <div class="resize-handle"></div>
                        `;
                } else {
                    novaPlanilha.innerHTML = `
                            <i class="fas fa-times-circle delete-icon" onclick="excluirTabela(this)"></i>
                            <i class="fas fa-edit edit-icon" onclick="editarTabela(this)"></i>
                            <img src="https://i.imgur.com/tIxuIE3.png" class="logo" alt="Logo" style="display: ${comLogo ? 'block' : 'none'}; width: 190px; height: fit-content; margin-left: 10px;">
                            <div class="content-container">
                                <div class="produto" id="produto-nome">${produto}</div>
                                <div class="info">
                                    <span class="preco">R$ ${parseFloat(preco).toFixed(2).replace('.', ',')}</span>
                                </div>
                                <div class="adicional">
                                    <span id="preco-por-litro">1 LITRO SAI POR R$ ${parseFloat(precoPorLitro).toFixed(2).replace('.', ',')}</span>
                                    <div class="info">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span id="data-emitida">Data emitida: ${data}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="resize-handle"></div>
                        `;
                }

                planilha.replaceWith(novaPlanilha);
                ativarRedimensionamento(novaPlanilha);
            });

            btnToggleLayout.innerHTML = `<i class="fas fa-exchange-alt"></i> Mudar layout`;
            btnToggleLayout.classList.toggle('layout1', !isTagLayout);
            btnToggleLayout.classList.toggle('layout2', isTagLayout);
        }

        async function carregarDados() {
            try {
                let allProducts = [];
                let nextUrl = 'https://api.baserow.io/api/database/rows/table/322640/?user_field_names=true';

                while (nextUrl) {
                    const response = await axios({
                        method: 'GET',
                        url: nextUrl,
                        headers: {
                            Authorization: 'Token UkqZsuMMnwE59fMqs8OwXX60SASP7FOd'
                        }
                    });

                    allProducts = allProducts.concat(response.data.results);
                    nextUrl = response.data.next;
                }

                const resultadosComPreco = allProducts.filter(item => item.PREÇO && item.PREÇO !== "");

                const planilhaContainer = document.getElementById('planilhas');
                planilhaContainer.innerHTML = "";
                const today = new Date();
                const formattedDate = today.toLocaleDateString('pt-BR');
                dataInput.value = formattedDate;

                let somaTotal = 0;
                let paginaAtual = document.createElement('div');
                paginaAtual.classList.add('pagina-impressao');
                planilhaContainer.appendChild(paginaAtual);
                const comLogo = logoCheckbox.checked;
                let itensNaPagina = 0;

                resultadosComPreco.forEach((item, index) => {
                    const precoTotal = parseFloat(item.PREÇO) * parseInt(item.QUANTIDADE, 10);
                    somaTotal += precoTotal;

                    let prelitro = parseFloat(item.PREÇO) / parseFloat(item.ML) * 1000;
                    if (item.PRODUTO.toLowerCase().includes('leite')) {
                        prelitro /= 1000;
                    }

                    const codigo = item.CODIGO || firstProduct.codigo;

                    const novaPlanilha = document.createElement('div');
                    novaPlanilha.classList.add(isTagLayout ? 'tag' : 'planilha');
                    novaPlanilha.style.breakInside = 'avoid';
                    novaPlanilha.dataset.codigo = codigo;

                    if (isTagLayout) {
                        novaPlanilha.innerHTML = `
                                <i class="fas fa-times-circle delete-icon" onclick="excluirTabela(this)"></i>
                                <i class="fas fa-edit edit-icon" onclick="editarTabela(this)"></i>
                                <img src="https://i.imgur.com/tIxuIE3.png" class="logo" alt="Logo" style="display: ${comLogo ? 'block' : 'none'}; position: absolute; top: 10px; right: 10px; width: 190px; height: fit-content; margin-left: 50px;">
                                <div class="topo"><i class="fa-solid fa-box"></i> ${item.PRODUTO}</div>
                                <div class="valor">R$ ${precoTotal.toFixed(2).replace('.', ',')}</div>
                                <div class="unitario"><i class="fa-solid fa-droplet"></i>Preço por litro: R$ ${prelitro.toFixed(2).replace('.', ',')}</div>
                                <div class="rodape">
                                    <div class="codigo"><i class="fa-solid fa-barcode"></i>${codigo}</div>
                                    <div class="data"><i class="fa-solid fa-calendar-day"></i>${formattedDate}</div>
                                </div>
                                <div class="resize-handle"></div>
                            `;
                    } else {
                        novaPlanilha.innerHTML = `
                                <i class="fas fa-times-circle delete-icon" onclick="excluirTabela(this)"></i>
                                <i class="fas fa-edit edit-icon" onclick="editarTabela(this)"></i>
                                <img src="https://i.imgur.com/tIxuIE3.png" class="logo" alt="Logo" style="display: ${comLogo ? 'block' : 'none'}; width: 190px; height: fit-content; margin-left: 10px;">
                                <div class="content-container">
                                    <div class="produto" id="produto-nome">${item.PRODUTO}</div>
                                    <div class="info">
                                        <span class="preco">R$ ${precoTotal.toFixed(2).replace('.', ',')}</span>
                                    </div>
                                    <div class="adicional">
                                        <span id="preco-por-litro">1 LITRO SAI POR R$ ${prelitro.toFixed(2).replace('.', ',')}</span>
                                        <div class="info">
                                            <i class="fas fa-calendar-alt"></i>
                                            <span id="data-emitida">Data emitida: ${formattedDate}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="resize-handle"></div>
                            `;
                    }

                    if (itensNaPagina >= 6) {
                        paginaAtual = document.createElement('div');
                        paginaAtual.classList.add('pagina-impressao');
                        planilhaContainer.appendChild(paginaAtual);
                        itensNaPagina = 0;
                    }

                    paginaAtual.appendChild(novaPlanilha);
                    itensNaPagina++;
                    ativarRedimensionamento(novaPlanilha);
                });

                Swal.fire({
                    icon: 'success',
                    title: 'Dados Carregados',
                    text: `Foram carregados ${resultadosComPreco.length} produtos com preço.`
                });
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erro',
                    text: 'Não foi possível carregar os dados.'
                });
            }
        }

        function excluirTabela(element) {
            const planilha = element.closest('.planilha, .tag');
            const produtoElement = planilha.querySelector(isTagLayout ? '.topo' : '#produto-nome');
            const produtoNome = produtoElement ? produtoElement.textContent.replace(/^\s*[\w\s]+\s*/, '').trim() : 'Produto Desconhecido';
            const codigo = planilha.dataset.codigo || 'Sem Código';

            deletedProducts.push({ nome: produtoNome, codigo: codigo });

            const popupDeletaPrecos = document.getElementById('popupDeletaPrecos');
            const produtosDeletados = document.getElementById('produtosDeletados');
            produtosDeletados.innerHTML = '';

            deletedProducts.forEach(prod => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="fas fa-trash"></i>${prod.nome} (Cód: ${prod.codigo})`;
                produtosDeletados.appendChild(li);
            });

            popupDeletaPrecos.classList.add('show');

            setTimeout(() => {
                const lis = produtosDeletados.querySelectorAll('li');
                lis.forEach((li, index) => {
                    setTimeout(() => {
                        li.classList.add('deleting');
                        setTimeout(() => {
                            li.remove();
                            if (index === lis.length - 1) {
                                popupDeletaPrecos.classList.remove('show');
                                deletedProducts = [];
                            }
                        }, 1000);
                    }, index * 200);
                });
            }, 2000);

            planilha.remove();
        }

        function editarTabela(element) {
            const planilha = element.closest('.planilha, .tag');
            const produtoElement = planilha.querySelector(isTagLayout ? '.topo' : '#produto-nome');
            const precoElement = planilha.querySelector(isTagLayout ? '.valor' : '.preco');
            const precoPorLitroElement = planilha.querySelector(isTagLayout ? '.unitario' : '#preco-por-litro');
            const dataElement = planilha.querySelector(isTagLayout ? '.data' : '#data-emitida');
            const codigoElement = isTagLayout ? planilha.querySelector('.codigo') : null;

            const produto = produtoElement ? produtoElement.textContent.replace(/^\s*[\w\s]+\s*/, '').trim() : '';
            const preco = precoElement ? precoElement.textContent.replace('R$ ', '').replace(',', '.') : '';
            const precoPorLitro = precoPorLitroElement ? precoPorLitroElement.textContent.match(/R\$ \d+,\d{2}/)[0].replace('R$ ', '').replace(',', '.') : '';
            const data = dataElement ? dataElement.textContent.replace('Data emitida: ', '').trim() : '';
            const codigo = codigoElement ? codigoElement.textContent.replace(/^\s*[\w\s]+\s*/, '').trim() : planilha.dataset.codigo;

            produtoInput.value = produto;
            precoInput.value = preco;
            document.getElementById('preco-litro-input').value = precoPorLitro;
            dataInput.value = data;
            codigoInput.value = codigo;

            Swal.fire({
                icon: 'info',
                title: 'Editando Produto',
                text: 'Os dados do produto foram carregados nos campos para edição. Altere e clique em "Adicionar" para criar uma nova tabela.'
            });
        }

        async function limparPrecos() {
            try {
                // Limpar preços no banco de dados
                let allProducts = [];
                let nextUrl = 'https://api.baserow.io/api/database/rows/table/322640/?user_field_names=true';

                while (nextUrl) {
                    const response = await axios({
                        method: 'GET',
                        url: nextUrl,
                        headers: {
                            Authorization: 'Token UkqZsuMMnwE59fMqs8OwXX60SASP7FOd'
                        }
                    });

                    allProducts = allProducts.concat(response.data.results);
                    nextUrl = response.data.next;
                }

                const produtosDeletadosList = document.getElementById('produtosDeletados');
                produtosDeletadosList.innerHTML = '';
                deletedProducts = [];

                for (let item of allProducts) {
                    const preco = item.PREÇO;
                    const produtoId = item.id || item.ID;
                    const nomeProduto = item.PRODUTO || 'Sem Nome';
                    const codigo = item.CODIGO || 'Sem Código';

                    if (preco && preco !== '') {
                        try {
                            await axios({
                                method: 'PATCH',
                                url: `https://api.baserow.io/api/database/rows/table/322640/${produtoId}/?user_field_names=true`,
                                headers: {
                                    Authorization: 'Token UkqZsuMMnwE59fMqs8OwXX60SASP7FOd'
                                },
                                data: { PREÇO: '' }
                            });

                            deletedProducts.push({ nome: nomeProduto, codigo: codigo });
                        } catch (error) {
                            console.error(`Erro ao limpar preço do produto ${nomeProduto}:`, error);
                            Swal.fire({
                                icon: 'warning',
                                title: 'Erro Parcial',
                                text: `Não foi possível limpar o preço do produto ${nomeProduto}.`
                            });
                        }
                    }
                }

                // Limpar preços na interface
                const planilhas = document.querySelectorAll('.planilha, .tag');
                planilhas.forEach(planilha => {
                    const produtoElement = planilha.querySelector(isTagLayout ? '.topo' : '#produto-nome');
                    const produtoNome = produtoElement ? produtoElement.textContent.replace(/^\s*[\w\s]+\s*/, '').trim() : 'Produto Desconhecido';
                    const codigo = planilha.dataset.codigo || 'Sem Código';
                    if (!deletedProducts.some(p => p.nome === produtoNome && p.codigo === codigo)) {
                        deletedProducts.push({ nome: produtoNome, codigo: codigo });
                    }
                });

                // Exibir popup com produtos deletados
                const popupDeletaPrecos = document.getElementById('popupDeletaPrecos');
                deletedProducts.forEach(prod => {
                    const li = document.createElement('li');
                    li.innerHTML = `<i class="fas fa-trash"></i>${prod.nome} (Cód: ${prod.codigo})`;
                    produtosDeletadosList.appendChild(li);
                });

                popupDeletaPrecos.classList.add('show');

                setTimeout(() => {
                    const lis = produtosDeletadosList.querySelectorAll('li');
                    lis.forEach((li, index) => {
                        setTimeout(() => {
                            li.classList.add('deleting');
                            setTimeout(() => {
                                li.remove();
                                if (index === lis.length - 1) {
                                    popupDeletaPrecos.classList.remove('show');
                                    document.getElementById('planilhas').innerHTML = '';
                                    deletedProducts = [];
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Preços Limpos',
                                        text: 'Todos os preços foram removidos com sucesso da interface e do banco de dados!'
                                    });
                                }
                            }, 1000);
                        }, index * 200);
                    });
                }, 2000);
            } catch (error) {
                console.error('Erro ao limpar preços:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erro',
                    text: 'Não foi possível limpar os preços.'
                });
            }
        }

        function atualizarVisibilidadeLogo() {
            const comLogo = logoCheckbox.checked;
            const logos = document.querySelectorAll('.logo');
            logos.forEach(logo => {
                logo.style.display = comLogo ? 'block' : 'none';
            });
        }

        function ativarRedimensionamento(element) {
            const resizeHandle = element.querySelector('.resize-handle');
            if (!resizeHandle) return;

            resizeHandle.addEventListener('mousedown', initResize);

            function initResize(e) {
                e.preventDefault();
                window.addEventListener('mousemove', resize);
                window.addEventListener('mouseup', stopResize);
            }

            function resize(e) {
                const minWidth = 200;
                let newWidth = e.clientX - element.getBoundingClientRect().left;
                if (newWidth < minWidth) newWidth = minWidth;
                element.style.width = `${newWidth}px`;
            }

            function stopResize() {
                window.removeEventListener('mousemove', resize);
                window.removeEventListener('mouseup', stopResize);
            }
        }

        function imprimirTabelas() {
            window.print();
        }
    </script>
</body>
</html>
